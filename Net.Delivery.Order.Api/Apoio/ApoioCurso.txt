password do WSL: ????

#Blokerl
#Tópico
	- um consumidor pode consumir de mais de uma partição mais uma partição não pode ser consumida por mais de um consumidor
#Produtor	| Producer
	- responsável por enviar dados para kafka 
	- Características: alta taxa de transferência, e tolerânte a falhas, configurações flexíveis
	- Mensagens em formato string kafka salva em binário
	{chave para ordernar}
	
	- Schema {avro} se quisermanter padrão {json}
#Consumidor | Consumer
	- 

# Grupos de Consumidores

#Zookeeper
	- Kafka usa Zookeeper como servidor de configuração
	- Zookeeper que fala que será o "tópico | Bloker" vai ser lider  ou seja faz toda configuração do kafka
	*Obs: Quando cria kroster do zookeeper precisa criar um kroster do kafka também
# kay raft?? "Não recomendado o uso em produção"
	Eles começaram a criar toda essa, essa coordenação de distribuição e centralização de configurações.
	O pessoal tá criando uma feature interna no Kafka que faz isso, chamada "key Raft".
	Key Raft, ok.
	Essa configuração ela vai permitir então que seja o Keeper seja substituído pela sua feature interna
	do Apache Kafka.
	Então.
	Só que esse Raft ainda não pode ser usado em produção, tá?
	Ele não é recomendado ainda até esse momento desse vídeo.
	Ok, ele não é recomendado a utilização em produção em produção ainda.
	A recomendação é utilizar o modelo com o Keeper.
	Ok, obrigado, Espero que tenha ficado claro e qualquer dúvida, por favor, entre em contato.

	-----------------
	-> Podemos criar uma fila para mensagens com erros
	-> Outros serviço para de 5 minutos ou tempo desejado para tentar processar novamente a mensagens com erros
	#Comando para criar pasta no WSL linux
		//Para criar o diretório devKafka no WSL (Windows Subsystem for Linux), você pode usar o comando padrão do Linux:
		mkdir ~/devKafka
	#Pasta criada		
		\\wsl.localhost\Ubuntu\home\mmorais\devKafka
	# mmorais@mattt:~$ cd devKafka
		mmorais@mattt:~/devKafka$

	# Instale a versão 2.13-3.0.0 do Kafka através da execução dos seguintes comandos:
		mmorais@mattt:~/devKafka$ wget https://archive.apache.org/dist/kafka/3.0.0/kafka_2.13-3.0.0.tgz
		--2025-11-01 16:54:04--  https://archive.apache.org/dist/kafka/3.0.0/kafka_2.13-3.0.0.tgz
		Resolving archive.apache.org (archive.apache.org)... 65.108.204.189, 2a01:4f9:1a:a084::2
		Connecting to archive.apache.org (archive.apache.org)|65.108.204.189|:443... connected.
		HTTP request sent, awaiting response... 200 OK
		Length: 86396520 (82M) [application/x-gzip]
		Saving to: ‘kafka_2.13-3.0.0.tgz’

		kafka_2.13-3.0.0.tgz          100%[=================================================>]  82.39M  12.3MB/s    in 8.3s

		2025-11-01 16:54:13 (9.88 MB/s) - ‘kafka_2.13-3.0.0.tgz’ saved [86396520/86396520]

		mmorais@mattt:~/devKafka$
				
# Descomparctar o arquivo..tgz "tar xzf kafka_2.13-3.0.0.tgz"
	mmorais@mattt:~/devKafka$ tar xzf kafka_2.13-3.0.0.tgz
	mmorais@mattt:~/devKafka$ ls
	kafka_2.13-3.0.0  kafka_2.13-3.0.0.tgz
	mmorais@mattt:~/devKafka$
	
# Entrar na pasta descompactada:
	mmorais@mattt:~/devKafka$ cd kafka_2.13-3.0.0
	mmorais@mattt:~/devKafka/kafka_2.13-3.0.0$ ll
# entrar no diretório bin:
	mmorais@mattt:~/devKafka/kafka_2.13-3.0.0$ cd bin
# Agora dentro do diretório bin: ll para verificar os binários da pasta
	mmorais@mattt:~/devKafka/kafka_2.13-3.0.0/bin$ ll
# Startar o zookeeper e kafka para ver se vai dar certo
	mmorais@mattt:~/devKafka/kafka_2.13-3.0.0/bin$ ./zookeeper-server-start.sh ../config/zookeeper.properties
# Outra janela kkafka
	root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# ./kafka-server-start.sh ../config/server.properties
	
//------------para rodar dois terminal do ubuntu
## para entrar wls usando o terminal: iniciar -> pesquisar -> terminal -> na seta que tem escolhar -> ubuntu ->
	#depois botão direito e dupliclar para conseguir rodar os dois ao mesmo tempo
	
	///Erro:
		# copilote:
			///Erro ao tentar instalar kafka comand: ./kafka-server-start.sh ../config/server.properties  Erro: java.net.ConnectException: Connection refused at java.base/sun.nio.ch.SocketChannelImpl.checkConnect(Native Method) at java.base/sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:777) at org.apache.zookeeper.ClientCnxnSocketNIO.doTransport(ClientCnxnSocketNIO.java:344)
🧩 Causas comuns e como resolver | # Corrigiu o erro com os comandos abaixo
	1. ZooKeeper não está iniciado
		Kafka em modo clássico depende do ZooKeeper. Antes de iniciar o Kafka, você precisa iniciar o ZooKeeper:
		./zookeeper-server-start.sh ../config/zookeeper.properties
		Depois disso, tente iniciar o Kafka novamente:
		./kafka-server-start.sh ../config/server.properties
	

# Observação para  | Adicionar usuário como admin antes dos comando abaixo: 	mmorais@mattt:~/devKafka/kafka_2.13-3.0.0/bin$ sudo su
	//subir o zookeeper e kafka: 1º primeiro subir o zookeeper e depois kafka | agora para parar 1º o kafka e depois zookeeper
# Parar zookeeper:
	//Se você iniciou o ZooKeeper com:
		./zookeeper-server-start.sh ../config/zookeeper.properties
	//Parar com
		./zookeeper-server-stop.sh
#para o kafka
	// se iniciou com 
		./kafka-server-start.sh ../config/server.properties
	//parar com 
		./kafka-server-stop.sh
# outra alternativa:
	//pkill -f kafka.Kafka
	./zookeeper-server-start.sh ../config/zookeeper.properties
	./kafka-server-start.sh ../config/server.properties


///# mmorais@mattt:~/devKafka/kafka_2.13-3.0.0/bin$	bat criadas para iniciar e parar
	/*
		# mmorais@mattt:~/devKafka/kafka_2.13-3.0.0/bin$	bat criadas para iniciar e parar
			mmorais@mattt:~/devKafka/kafka_2.13-3.0.0/bin$ ./start-kafka.sh
			mmorais@mattt:~/devKafka/kafka_2.13-3.0.0/bin$ ./stop-kafka.sh


		mmorais@mattt:~/devKafka/kafka_2.13-3.0.0/bin$ sudo su
		root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# ./start-kafka.sh
		Iniciando ZooKeeper...
		Iniciando Kafka...
		Kafka e ZooKeeper iniciados em segundo plano.
		root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# ./stop-kafka.sh
		Encerrando Kafka...
		Encerrando ZooKeeper...
		Processos finalizados.
		root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin#
	*/

# adicionar o usuário como admin do ubuntu
		mmorais@mattt:~/devKafka/kafka_2.13-3.0.0/bin$ sudo su
		[sudo] password for mmorais:
		root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin#

	///Para saber se estou como admin: sud: vai ficar "root e # no final"
		root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin#

# PWD para saber qual diretório está:
	root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# pwd
	
# Subir zookeeper:	
	root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# ./zookeeper-server-start.sh ../config/zookeeper.properties
		
#Do lado direito fazer o mesmo com o Kafka
	mmorais@mattt:~/devKafka/kafka_2.13-3.0.0/bin$ sudo su
		mmorais@mattt:~/devKafka/kafka_2.13-3.0.0/bin$ cd ..
		mmorais@mattt:~/devKafka/kafka_2.13-3.0.0$ cd..
		cd..: command not found
		mmorais@mattt:~/devKafka/kafka_2.13-3.0.0$ cd ..
		mmorais@mattt:~/devKafka$ sudo su
		[sudo] password for mmorais:
		root@mattt:/home/mmorais/devKafka# cd kafka_2.13-3.0.0
		root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0# cd bin
		root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin#
		
		./kafka-server-start.sh ../config/server.properties
		
# Buscar todos os topics dentro do servido que vc está:
	root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# ./kafka-topics.sh --list --bootstrap-server localhost:9092
	./kafka-topics.sh --create --topic tp-test --bootstrap-server localhost:9092 --partitions 1 --replication-factor 1
	
	#instalando et-tools:
			Entendi, Martinho! O comando netstat não vem instalado por padrão em algumas distribuições Linux no WSL. Mas você pode instalar facilmente com o seguinte comando:

			🛠️ Instalar net-tools (inclui netstat)
			sudo apt update
			sudo apt install net-tools


			Depois disso, você poderá usar:
			netstat -tuln | grep 9092


			Esse comando verifica se o Kafka está escutando na porta 9092.

			💡 Alternativa moderna: usar ss
			Se preferir, pode usar o comando ss, que já vem instalado na maioria dos sistemas:
			ss -tuln | grep 9092



			Se quiser, posso montar um script de diagnóstico que verifica se o Kafka está rodando, se a porta está ativa e se os tópicos estão acessíveis. Quer que eu monte isso para você?

# root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# nano ../config/server.properties
	~/.local/share/nano
✅ Passos para sair do nano
	- Se você não fez alterações:
	#- Pressione Ctrl + X → isso fecha o editor imediatamente.
	- Se você fez alterações e quer salvar:
	- Pressione Ctrl + O → isso salva o arquivo.
	- Pressione Enter → confirma o nome do arquivo.
	- Pressione Ctrl + X → sai do editor.
	- Se você fez alterações e quer sair sem salvar:
	- Pressione Ctrl + X
	- Quando aparecer a pergunta Salvar as alterações? (S/N), pressione N → isso sai sem salvar.

#Verificar porta:
	netstat -tuln | grep 9092	
		ou
	ss -tuln | grep 9092
		root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# ss -tuln | grep 9092
		tcp   LISTEN 0      50                  *:9092             *:*
		root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# netstat -tuln | grep 9092
		tcp6       0      0 :::9092                 :::*                    LISTEN
		root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin#

----------------------------------
# Craiado topic:
	root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# ./start-kafka.sh
		Iniciando ZooKeeper...
		Iniciando Kafka...
		Kafka e ZooKeeper iniciados em segundo plano.
		root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# ./kafka-topics.sh --list --bootstrap-server localhost:9092

		root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# ./kafka-topics.sh --create --topic tp-test --bootstrap-server localhost:9092 --partitions 1 --replication-factor 1
		Created topic tp-test.
		root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# ./kafka-topics.sh --list --bootstrap-server localhost:9092
		tp-test
		root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin#

# Criar
	root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# 
		./kafka-topics.sh --create --topic tp-test --bootstrap-server localhost:9092 --partitions 1 --replication-factor 1
	Created topic tp-test.	
		./kafka-topics.sh --create --topic tp-test --bootstrap-server localhost:9092 --partitions 2 --replication-factor 1
#Listar:
		./kafka-topics.sh --list --topic tp-test --bootstrap-server localhost:9092 
# Describe:
	root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# 
		./kafka-topics.sh --describe --bootstrap-server localhost:9092 --topic tp-test
		Topic: tp-test  TopicId: qunwA_VBTG2lbIptZlqTvw PartitionCount: 1       ReplicationFactor: 1Configs: segment.bytes=1073741824
		Topic: tp-test  Partition: 0    Leader: 0       Replicas: 0     Isr: 0
		
# Alterar topic:
	./kafka-topics.sh --alter --topic tp-test --partitions 3 --bootstrap-server localhost:9092
	//root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# ./kafka-topics.sh --alter --topic tp-test --partitions 3 --bootstrap-server localhost:9092
		root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# ./kafka-topics.sh --describe --bootstrap-server localhost:9092 --topic tp-test
		Topic: tp-test  TopicId: MQzV2dNETVG3q_EF0d8tpw PartitionCount: 3       ReplicationFactor: 1Configs: segment.bytes=1073741824
				Topic: tp-test  Partition: 0    Leader: 0       Replicas: 0     Isr: 0
				Topic: tp-test  Partition: 1    Leader: 0       Replicas: 0     Isr: 0
				Topic: tp-test  Partition: 2    Leader: 0       Replicas: 0     Isr: 0
		root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin#
#Adicionar configuração ao topic criado e alteradndo "--add-config retention.ms=1000  retention"
	./kafka-configs.sh --alter --bootstrap-server localhost:9092 entity-type topics --entity-name tp-test --add-config retention.ms=1000

#Delete:
	./kafka-topics.sh --delete --topic tp-test --bootstrap-server localhost:9092
	
//Continuar aqui:
	https://www.udemy.com/course/apache-kafka-dotnet/learn/lecture/42301676#overview
	
## Crair topic | https://www.udemy.com/course/apache-kafka-dotnet/learn/lecture/42301676?start=0#overview
	//-> Produzir mensagem
	root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# ./kafka-console-producer.sh --broker-list localhost:9092 --topic tp-test
		>teste 01
		>teste 02
		>teste 03
		>

#-> Produzir mensagem com chave: key | parse.key=true --property key.separator=;
		./kafka-console-producer.sh --broker-list localhost:9092 --topic tp-test --property parse.key=true --property key.separator=;
		//Digitar mensagens
			> Chave1; conteudo_mensagem_10
			> chave1;conteudo_mensagem_11
# Consumer
		//./kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic tp-test --from-beginning
	root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# 
		./kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic tp-test --from-beginning
			teste 01
			teste 02
			teste 03
			teste 04
			teste 05
			teste 06
			teste 07
			chave1;conteudo_mensaegm_1
			chave2;conteudo_mensagem_2
			Chave1; conteudo_mensagem_10
			chave1;conteudo_mensagem_11

	///Consumir mensagens com chaves:
		///./kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic tp-test --from-beginning --property print.key=true --property key.separator=;
		root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# 
			./kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic tp-test --from-beginning --property print.key=true --property key.separator=;
				nullteste 01
				nullteste 02
				nullteste 03
				teste 04
				teste 05
				teste 06
				teste 07
				chave1;conteudo_mensaegm_1
				chave2;conteudo_mensagem_2
				Chave1; conteudo_mensagem_10
				chave1;conteudo_mensagem_11

# Grupos de consumer | Consumer Grouper
	///Listar groups
		./kafka-consumer-groups.sh --list --bootstrap-server localhost:9092
	# Criar consumer groups | earliest = mais antiga
	///	./kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group cgp-test --reset-offsets --to-earliest --topic tp-test --execute
		root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin#
			./kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group cgp-test --reset-offsets --to-earliest --topic tp-test --execute
			GROUP                          TOPIC                          PARTITION  NEW-OFFSET
			cgp-test                       tp-test                        0          0
			root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin#
	#Listar os consumer groups
		root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# 
			./kafka-consumer-groups.sh --list --bootstrap-server localhost:9092
			cgp-test
			root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin#
	#describe o consumer-groups
		./kafka-consumer-groups.sh --describe --group cgp-test  --bootstrap-server localhost:9092	
		root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# ./kafka-consumer-groups.sh --describe --group cgp-test  --bootstrap-server localhost:9092

			Consumer group 'cgp-test' has no active members. //| Não tem nenhum consumidor dentro dele

			GROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID     HOST            CLIENT-ID
			cgp-test        tp-test         0          0               13              13              -               -               -
			root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin#
	# Criar consumidor para groups:
		Comando para criar consumidor de mensagem vinculando a um group
		///./kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic tp-test --from-beginning --group cgp-test
	root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# 
		./kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic tp-test --from-beginning --group cgp-test
		teste 01
		teste 02
		teste 03
		teste 04
		teste 05
		teste 06
		teste 07
		chave1;conteudo_mensaegm_1
		chave2;conteudo_mensagem_2
		Chave1; conteudo_mensagem_10
		chave1;conteudo_mensagem_11
		Chave_vasco;cmensagem_campeeao_copa_do_brasil
		Chave_vasco:mensagem_sexto_colocado_campeonato_braseleiro

	///Novamente o describe agora retorna as informações do GROUP
	root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin# 
		./kafka-consumer-groups.sh --describe --group cgp-test  --bootstrap-server localhost:9092

	GROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                                              	HOST            CLIENT-ID
	cgp-test        tp-test         0          13              13              0               consumer-cgp-test-1-cb41b5fd-d64a-4600-8284-218afd9f42cb 	/127.0.0.1      consumer-cgp-test-1
	root@mattt:/home/mmorais/devKafka/kafka_2.13-3.0.0/bin#

############--------------Projeto .net -------------------
-> Docker Protocolo jms de mensageiria 
	- "9101:9101"
	
#Subir o docker compose do projeto via linha de comando abrir o "terminal"
	PS C:\Users\mattt> cd C:\devKafka\netdelivery
		PS C:\devKafka\netdelivery> docker-compose up -d
			time="2025-11-02T12:40:42-03:00" level=warning msg="C:\\devKafka\\netdelivery\\docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
			[+] Running 24/24
			 ✔ kafdrop Pulled                                                                                                 20.6s
			   ✔ 32f112e3802c Pull complete                                                                                   11.2s
			   ✔ 481458cb46c8 Pull complete                                                                                   12.0s
			   ✔ 677bf9d04d46 Pull complete                                                                                   15.7s
			   ✔ 1a2934f5c9d3 Pull complete                                                                                   15.8s
			   ✔ 1239a44b9c56 Pull complete                                                                                   15.8s
			   ✔ 83d6a7ec7fd8 Pull complete                                                                                   15.8s
			   ✔ 2d4619403d54 Pull complete                                                                                   16.1s
			   ✔ 4f4fb700ef54 Pull complete                                                                                   16.1s
			 ✔ kafka Pulled                                                                                                   19.9s
			   ✔ 59e2e89eee9d Pull complete                                                                                   15.9s
			   ✔ 890d6a70df7a Pull complete                                                                                   15.9s
			 ✔ zookeeper Pulled                                                                                               19.9s
			   ✔ c2c17d84f25a Pull complete                                                                                    2.7s
			   ✔ 46cdcde062b2 Pull complete                                                                                    2.7s
			   ✔ e73521032be7 Pull complete                                                                                   15.1s
			   ✔ 77c96a9d0aa1 Pull complete                                                                                   15.1s
			   ✔ ff3e60059bc7 Pull complete                                                                                   15.2s
			   ✔ 0b6fc8737347 Pull complete                                                                                   15.4s
			   ✔ 1d8caf36535f Pull complete                                                                                   15.4s
			   ✔ 3b830c3d08d4 Pull complete                                                                                   15.4s
			   ✔ 16d280dca34c Pull complete                                                                                   15.4s
			   ✔ 2308e5736c70 Pull complete                                                                                   15.9s
			   ✔ 6855ebdfcdc5 Pull complete                                                                                   15.9s
			[+] Running 4/4
			 ✔ Network netdelivery_default  Created                                                                            0.0s
			 ✔ Container zookeeper          Started                                                                            0.9s
			 ✔ Container kafka              Started                                                                            0.9s
			 ✔ Container kafdrop            Started                                                                            1.1s
			PS C:\devKafka\netdelivery>

			
# Entrar no container docker via linha de comando
	PS C:\devKafka\netdelivery> docker exec -it kafka /bin/bash
	[appuser@kafka ~]$

# Localizar topics via comando docker
	///	./kafka-topics --list --bootstrap-server localhost:9092
		[appuser@kafka bin]$ ./kafka-topics --list --bootstrap-server localhost:9092
			[appuser@kafka bin]$
	#Crair topic order via comando docker | remover .sh do comerço do comando: ./kafka-topics.sh		
	///Comando para criar topic
		./kafka-topics --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic tp-order
	
	[appuser@kafka bin]$ ./kafka-topics --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic tp-order
		Created topic tp-order.
		[appuser@kafka bin]$
			
	# Criar consumer: remover .sh ./kafka-console-consumer.sh consumir mensagem desde oinicio
		[appuser@kafka bin]$ ./kafka-console-consumer --bootstrap-server localhost:9092 --topic tp-order --from-beginning
	///Depois que o pedido é criado no swagger aparece no console o conteúdo da mensagem
		{"OrderId":"ad2f506d-75bb-475a-af13-791efaaba290","OrderCreateDate":"2025-11-02T13:47:05.3548582-03:00","OrderLastUpdate":"2025-11-02T13:47:05.3548582-03:00","OrderSituation":0,"Items":["Pizza"],"Customer":{"Name":"Martinho","PhoneNumber":"1199999-9999","Email":"teste@teste.com"}}
	#descompactada via docker
	[appuser@kafka bin]$ ./kafka-consumer-groups --describe --group cgp-notifier  --bootstrap-server localhost:9092